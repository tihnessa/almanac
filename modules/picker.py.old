import tkinter as tk
from tkinter import ttk
import tkinter.font as TkFont
from functools import partial


class Picker(ttk.Frame):
    def __init__(self, parent, table, columns, headings, mode='browse'):
        super().__init__(parent)
        self.dbo = parent.dbo
        self.table = table
        self.columns = columns
        self.headings = headings

        self.columns.append('id')
        self.headings.append('ID')

        rows = self.dbo.select_data(table, columns)

        self.picker = ttk.Treeview(self, columns=self.columns[1:], selectmode=mode)
        self.picker.heading('#0', text=headings[0])
        for i, v in enumerate(headings[1:], start=1):
            self.picker.heading(columns[i], text=v)
        self.picker.insert('', 'end', text=parent.new_prompt)
        for row in rows:
            self.picker.insert('', 'end', text=row[0], values=row[1:])
        for column in self.picker['columns']:
            self.picker.column(column, width=TkFont.Font().measure(self.picker.heading(column)['text']))
            for row in self.picker.get_children(''):
                item_width = TkFont.Font().measure(self.picker.set(row, column))
                self.picker.column(column, width=max(self.picker.column(column, 'width')+10, item_width+10))
        self.picker.grid()
        self.picker.bind('<<TreeviewOpen>>', self.on_open)

    def on_open(self, *args):
        selected = self.picker.selection()
        print(selected)
